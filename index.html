<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Morning Check-In</title>

<!-- QR Scanner Library -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f0f2f5;
        margin: 0;
        padding: 20px;
    }
    h2 {
        margin-top: 10px;
    }
    #reader {
        width: 90vw;
        max-width: 400px;
        margin: auto;
    }
    #successMsg {
        margin-top: 25px;
        font-size: 1.2em;
        font-weight: bold;
        color: #1db954; /* 柔和亮绿 */
        display: none;
    }
</style>
</head>
<body>

<h2 id="greeting">Good morning!</h2>

<div id="reader"></div>

<p id="successMsg">Successfully Checked In.</p>

<!-- Hidden iframe for form submit -->
<iframe name="hiddenFrame" style="display:none;"></iframe>

<!-- Hidden form to submit to GAS -->
<form id="submitForm" method="POST" target="hiddenFrame"></form>

<script>
// 取得 URL 參數 ?user=XXXX
function getUser() {
    const params = new URLSearchParams(window.location.search);
    return params.get("user") || "Guest";
}

// 顯示 Good morning, XXX!
const username = getUser();
document.getElementById("greeting").textContent = `Good morning, ${username}!`;

// GAS URL（你会用你真正部署出来的 URL 来换掉）
const GAS_URL = "YOUR_GAS_DEPLOYED_WEBAPP_URL";

// QR 触发字串（你要求的内容）
const QR_TARGET_TEXT = "CHECK IN RECORD FOR YEAR 2025";

// 启动 QR Scanner
function onScanSuccess(decodedText, decodedResult) {
    if (decodedText.trim() === QR_TARGET_TEXT) {
        
        // 显示成功讯息
        document.getElementById("successMsg").style.display = "block";

        // 建立时间
        const now = new Date().toISOString();

        // 建立 form POST
        const form = document.getElementById("submitForm");
        form.innerHTML = `
            <input type="hidden" name="name" value="${username}">
            <input type="hidden" name="timestamp" value="${now}">
        `;
        form.action = GAS_URL; // GAS 部署出来的网址
        form.submit();

        // 停止扫描
        html5QrcodeScanner.clear();
    }
}

var html5QrcodeScanner = new Html5QrcodeScanner(
    "reader", { fps: 10, qrbox: 250 }, false);
html5QrcodeScanner.render(onScanSuccess);
</script>

</body>
</html>
